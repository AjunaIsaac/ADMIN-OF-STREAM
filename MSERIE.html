<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Content - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Note: The style.css link is kept, but the new styles below will heavily override it. -->
    <link rel="stylesheet" href="style.css">
    <style>
        /* --- Redesign Styles Based on Image --- */
        
        :root {
            --primary-bg: #0A0F2A; /* Dark Navy Blue */
            --card-bg: #1C2141; /* Slightly Lighter Blue for Cards */
            --accent-color: #DFFF00; /* Vibrant Yellow-Green */
            --text-primary: #FFFFFF;
            --text-secondary: #a9a9b3;
            --logout-bg: #e74c3c;
            --input-bg: #0A0F2A;
            --success-color: #4CAF50;
            --danger-color: #f44336;
            --info-color: #2196F3;
        }

        /* --- General Body & Font Styles --- */
        body {
            background-color: var(--primary-bg);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
        }

        /* --- Responsive Menu Layout (No Design Change, Just Structure) --- */
        #adminPanel {
            display: flex;
        }

        #mainMenu {
            width: 250px;
            flex-shrink: 0;
            background-color: #111533; /* Darker menu background */
            min-height: 100vh;
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .main-content {
            flex-grow: 1;
            padding: 1.5rem;
        }
        
        /* --- Header Redesign --- */
        .admin-header {
            display: flex;
            flex-wrap: wrap; /* Allows items to wrap on small screens */
            justify-content: space-between;
            align-items: flex-start; /* Align to the top */
            gap: 15px;
            margin-bottom: 10px;
        }

        .header-title-section {
            flex-grow: 1;
        }

        .admin-header h1 {
            color: var(--accent-color);
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1.1;
            margin: 0;
        }
        
        .user-info {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        /* --- Hamburger Menu Button Redesign --- */
        #menuToggleBtn {
            display: block; /* Always visible for this design */
            position: static; /* No longer fixed position */
            background: transparent;
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            margin-right: 20px; /* Space between button and title */
        }
        
        /* --- Logout Button Redesign --- */
        .logout-btn {
            background-color: var(--logout-bg);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* --- Search View (Card) Redesign --- */
        #searchView {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 15px;
            margin-top: 2rem;
        }
        
        #searchView h2 {
             font-size: 1.2rem;
             color: var(--text-primary);
             margin: 0 0 10px 0;
        }

        .form-group input[type="text"], .form-group input[type="url"] {
            width: 100%;
            background-color: var(--input-bg);
            border: 1px solid #33395b;
            border-radius: 8px;
            padding: 15px;
            color: var(--text-primary);
            font-size: 1rem;
            margin-top: 5px;
            box-sizing: border-box; /* Important for padding and width */
        }
        
        /* --- Search Button Redesign --- */
        #searchTmdbBtn {
            width: 100%;
            background: linear-gradient(90deg, #FF416C, #FFDE00);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 1.5rem;
            transition: transform 0.2s ease;
        }
        #searchTmdbBtn:hover {
            transform: scale(1.02);
        }

        /* General Message Styling */
        .message { margin-top: 20px; padding: 12px; border-radius: 5px; text-align: center; display: none; }
        .message.success { background-color: var(--success-color); }
        .message.error { background-color: var(--danger-color); }
        .message.info { background-color: var(--info-color); }


        /* --- Mobile Menu Functionality --- */
        @media (max-width: 768px) {
             #adminPanel {
                flex-direction: column;
             }
            .admin-header {
                /* Combine menu button and title section for better mobile layout */
                align-items: center;
            }
             .header-title-section {
                /* Reduce top margin on mobile */
                margin-top: 0;
            }
            .admin-header h1 {
                font-size: 2rem;
            }

            #mainMenu {
                position: fixed;
                left: 0;
                top: 0;
                height: 100%;
                transform: translateX(-100%);
            }

            #mainMenu.open {
                transform: translateX(0);
            }
        }
         @media (min-width: 769px) {
             #menuToggleBtn {
                 display: none; /* Hide hamburger on desktop */
             }
        }


    </style>
</head>
<body>
    <div id="adminPanel">
        <!-- The Menu (Sidebar) -->
        <nav id="mainMenu">
            <div class="menu-header">Admin Menu</div>
            <a href="index.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <hr style="border-color: #333; margin: 10px 0;">
            <a href="manage-movies.html"><i class="fas fa-film"></i> Manage Movies</a>
            <a href="manage-series.html" class="active"><i class="fas fa-tv"></i> Manage Series</a>
            <a href="manage-banners.html"><i class="fas fa-images"></i> Manage Banners</a>
            <a href="manage-notifications.html"><i class="fas fa-paper-plane"></i> Notifications</a>
            <a href="manage-users.html"><i class="fas fa-users-cog"></i> User Management</a>
        </nav>

        <!-- The Main Content Area -->
        <div class="main-content">
            <div class="admin-header">
                <!-- Grouping menu button and title for better layout control -->
                <div style="display: flex; align-items: center;">
                    <button id="menuToggleBtn"><i class="fas fa-bars"></i></button>
                    <div class="header-title-section">
                        <h1>Search & Manage<br>Content</h1>
                    </div>
                </div>
                <button class="logout-btn" id="logoutBtn">Logout <i class="fas fa-sign-out-alt"></i></button>
            </div>
            
            <p class="user-info">Logged in as: support@streamzonemovies.online</p>

            <div id="manageSeriesPage" class="page-container" style="display: block;">
                <!-- SEARCH CARD -->
                <div id="searchView">
                    <h2>Search by Content Name, TMDB ID or Unique Text ID</h2>
                    <div class="form-group">
                        <input type="text" id="seriesSearchQuery" placeholder="Enter search term...">
                    </div>
                    <button id="searchTmdbBtn">Search Content</button>
                    <div id="searchResultsContainer"></div>
                </div>
                
                <!-- This part is hidden by default, and will appear after a search -->
                <div id="detailsView" style="display: none;">
                    <!-- The rest of your content remains here without design changes -->
                    <div id="detailsHeader">
                        <img id="seriesPoster" src="" alt="Series Poster">
                        <div><h2 id="seriesTitle"></h2><p id="seriesOverview"></p></div>
                    </div>
                    <div class="form-group"><label for="vjName">VJ Name (Required)</label><input type="text" id="vjName" required></div>
                    <div class="form-group"><label>Categories</label><div class="checkbox-group" id="seriesCategories"></div></div>
                    <h2>Episodes</h2>
                    <div class="episode-table-wrapper"><table class="episode-table"><thead><tr><th>#</th><th>Name</th><th>Thumbnail</th><th>Description</th><th>Video link</th><th>Publish</th><th>Premium</th></tr></thead><tbody id="episodesTableBody"></tbody></table></div>
                    <div style="margin-top: 30px; border-top: 1px solid #555; padding-top: 20px;">
                      <h3>For Sort Page Only</h3>
                      <div class="form-group"><label>VJs for Sort Page</label><div class="checkbox-group" id="sortVjsCheckboxes"></div></div>
                    </div>
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button id="submitSeriesBtn" style="flex: 1;">Create Series</button>
                        <button id="cancelBtn" style="flex: 1; background: #555;">Cancel</button>
                    </div>
                </div>

                <div id="formMessage" class="message"></div>
            </div>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Firebase Configuration ---
        const firebaseConfig = { 
            apiKey: "AIzaSyCgbaRR6ezvswehl1Q21ICHgBtXZ9bcLwA", 
            authDomain: "my-movies-admin.firebaseapp.com", 
            projectId: "my-movies-admin", 
            storageBucket: "my-movies-admin.firebasestorage.app", 
            messagingSenderId: "492775126123", 
            appId: "1:492775126123:web:7ad51095ff15f61ed12d2e" 
        };
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);
        const auth = firebase.auth(app);

        // --- TMDB and Global Variables ---
        const TMDB_API_KEY = "f7a3b097ba7a990fd0c8ef3147646fb5";
        let currentSeriesData = null;
        let editModeDocId = null;
        const VJ_LIST = ["Vj Junior", "Vj TONNY", "Vj Emmy", "Heavy q","Vj Mk","Vj SHIELD","Vj Light","Vj BONNY", "VJ NEIL", "Vj Jovan", "Vj Tom", "Vj Shao Khan", "Vj Jingo", "Vj Ice P", "Vj Kevo", "Vj Kevin", "Vj Kriss Sweet", "Vj Hd", "Vj Dan De", "Vj Sammy", "Vj Ivo", "Vj Isma K", "Vj Little T", "Vj Mox", "Vj Muba", "Vj Eddy", "Vj Kam", "Vj Lance", "Vj KS", "Vj Ulio", "Vj Aaron", "Vj Cabs", "Vj Banks", "Vj Jimmy", "Vj Baros", "Vj SOUL", "Vj SON", "Vj Kimuli", "Vj Fredy", "Vj Jumpers", "Vj Ashim", "Vj Pauleta", "Vj Martin K", "Vj Henrico", "Vj Uncle T", "Vj RONAGE"];
        
        // ✅ --- UPDATED CATEGORY LIST --- ✅
        const SERIES_CATEGORIES = [
            { value: 'latest_uploads', label: 'Latest Uploads' },
            { value: 'most_liked', label: 'Latest On Jmovies' },
            { value: 'upcoming_shows', label: 'Upcoming Shows' },
            { value: 'western_series', label: 'Western Series' },
            { value: 'Latest-TV-Series', label: 'Latest Tv Shows' },
            { value: 'k_dramas', label: 'K Dramas' },
            { value: 'send_notification', label: 'Send Notification' }
        ];

        // --- DOM Element Selection ---
        const searchView = document.getElementById('searchView');
        const detailsView = document.getElementById('detailsView');
        const searchTmdbBtn = document.getElementById('searchTmdbBtn');
        const searchResultsContainer = document.getElementById('searchResultsContainer');
        const episodesTableBody = document.getElementById('episodesTableBody');
        const submitSeriesBtn = document.getElementById('submitSeriesBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const formMessage = document.getElementById('formMessage');
        const menuToggleBtn = document.getElementById('menuToggleBtn');
        const mainMenu = document.getElementById('mainMenu');

        // --- Helper Functions ---
        const setLoading = (btn, isLoading) => { if(btn) { btn.classList.toggle('loading', isLoading); btn.disabled = isLoading; }};
        const displayMessage = (msg, type) => { formMessage.textContent = msg; formMessage.className = `message ${type}`; formMessage.style.display = 'block'; setTimeout(() => { formMessage.style.display = 'none'; }, 8000); };
        const generateSlug = (text) => text.toString().toLowerCase().trim().replace(/\s+/g, '-').replace(/[^\w\-]+/g, '').replace(/\-\-+/g, '-');
        
        async function sendNotification(title, body, imageUrl = '', url = '', msgElement) {
            const payload = { title, body, imageUrl, url };
            try {
                const functionUrl = 'https://jmovies.ajunaisaac-ug.workers.dev';
                const response = await fetch(functionUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if (response.ok) {
                    msgElement.innerHTML += '<br>Notification sent successfully!';
                } else {
                    msgElement.innerHTML += `<br>Failed to send notification: ${result.error || 'Unknown error'}`;
                }
            } catch (error) {
                msgElement.innerHTML += `<br>Notification network error: ${error.message}`;
            }
        }

        async function checkForDuplicates(payload, excludeDocId = null) {
            if (!payload.unique_reference_id) return { found: false };
            const q = db.collection('movies').where('unique_reference_id', '==', payload.unique_reference_id);
            const snapshot = await q.get();
            for (const doc of snapshot.docs) {
                if (doc.id !== excludeDocId) return { found: true, field: 'This exact VJ version already exists.' };
            }
            return { found: false };
        }

        // ✅ --- UPDATED CHECKBOX FUNCTION --- ✅
        function populateCheckboxes(containerId, list, selectedValues = []) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = '';
            list.forEach(item => {
                const labelEl = document.createElement('label');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = containerId;
                
                // Handles both simple arrays (like VJ_LIST) and object arrays (like SERIES_CATEGORIES)
                if (typeof item === 'object' && item !== null) {
                    checkbox.value = item.value;
                    checkbox.checked = selectedValues.includes(item.value);
                    labelEl.appendChild(checkbox);
                    labelEl.appendChild(document.createTextNode(` ${item.label}`));
                } else {
                    checkbox.value = item;
                    checkbox.checked = selectedValues.includes(item);
                    labelEl.appendChild(checkbox);
                    labelEl.appendChild(document.createTextNode(` ${item}`));
                }
                container.appendChild(labelEl);
            });
        }
        
        // --- Core Application Logic & Event Listeners ---

        if (menuToggleBtn && mainMenu) {
            menuToggleBtn.addEventListener('click', () => {
                mainMenu.classList.toggle('open');
            });
        }

        auth.onAuthStateChanged(user => { 
            if (!user) {
                window.location.href = 'index.html'; 
            } else {
                initializePage();
            }
        });
        
        document.getElementById('logoutBtn').addEventListener('click', () => auth.signOut());

        function initializePage() {
            populateCheckboxes('sortVjsCheckboxes', VJ_LIST);
            populateCheckboxes('seriesCategories', SERIES_CATEGORIES);
            const urlParams = new URLSearchParams(window.location.search);
            const docId = urlParams.get('id');
            if (docId) {
                editModeDocId = docId;
                loadSeriesForEditing(docId);
            } else {
                searchView.style.display = 'block';
                detailsView.style.display = 'none';
            }
        }

        searchTmdbBtn.addEventListener('click', async () => {
            const query = document.getElementById('seriesSearchQuery').value;
            if (!query) return;
            setLoading(searchTmdbBtn, true);
            searchResultsContainer.innerHTML = '<p class="message info" style="display:block">Searching...</p>';
            try {
                const response = await fetch(`https://api.themoviedb.org/3/search/tv?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(query)}`);
                const data = await response.json();
                displaySearchResults(data.results);
            } catch (error) {
                searchResultsContainer.innerHTML = `<p class="message error" style="display:block">Error: ${error.message}</p>`;
            } finally {
                setLoading(searchTmdbBtn, false);
            }
        });

        function displaySearchResults(results) {
            searchResultsContainer.innerHTML = '';
            if (!results || results.length === 0) {
                searchResultsContainer.innerHTML = '<p class="message info" style="display:block">No results found.</p>';
                return;
            }
            results.forEach(series => {
                const posterPath = series.poster_path ? `https://image.tmdb.org/t/p/w200${series.poster_path}` : 'https://placehold.co/100x150?text=N/A';
                searchResultsContainer.innerHTML += `
                    <div class="content-card">
                        <div class="content-card-content">
                            <div class="content-card-poster"><img src="${posterPath}" alt="${series.name}"></div>
                            <div class="content-card-info">
                                <h3>${series.name} ${series.first_air_date ? `(${series.first_air_date.split('-')[0]})` : ''}</h3>
                                <p>${series.overview}</p>
                            </div>
                        </div>
                        <div class="content-card-actions"><button class="select-btn" data-id="${series.id}">Select</button></div>
                    </div>`;
            });
        }

        searchResultsContainer.addEventListener('click', async e => {
            if (e.target.classList.contains('select-btn')) {
                setLoading(e.target, true);
                await fetchAndDisplaySeriesDetails(e.target.dataset.id);
                setLoading(e.target, false);
            }
        });

        async function fetchAndDisplaySeriesDetails(seriesId, existingEpisodesData = null) {
            displayMessage("Fetching details...", "info");
            try {
                const response = await fetch(`https://api.themoviedb.org/3/tv/${seriesId}?api_key=${TMDB_API_KEY}`);
                const data = await response.json();
                currentSeriesData = data;

                document.getElementById('seriesPoster').src = data.poster_path ? `https://image.tmdb.org/t/p/w200${data.poster_path}` : '';
                document.getElementById('seriesTitle').textContent = data.name;
                document.getElementById('seriesOverview').textContent = data.overview;
                
                episodesTableBody.innerHTML = '';
                let globalEpisodeCounter = 1;
                for (const season of data.seasons) {
                    if (season.season_number === 0) continue;
                    const seasonDetailsResponse = await fetch(`https://api.themoviedb.org/3/tv/${seriesId}/season/${season.season_number}?api_key=${TMDB_API_KEY}`);
                    const seasonDetails = await seasonDetailsResponse.json();
                    seasonDetails.episodes.forEach(episode => {
                        const existingEp = existingEpisodesData ? existingEpisodesData.find(ep => ep.season_number === episode.season_number && ep.episode_number === episode.episode_number) : null;
                        const row = document.createElement('tr');
                        row.dataset.seasonNumber = episode.season_number;
                        row.dataset.episodeNumber = episode.episode_number;
                        const stillPath = episode.still_path ? `https://image.tmdb.org/t/p/w200${episode.still_path}` : 'https://placehold.co/120x68?text=N/A';
                        const publishChecked = existingEp ? (existingEp.published ? 'checked' : '') : '';
                        row.innerHTML = `<td>${globalEpisodeCounter}</td><td class="ep-name">${episode.name}</td><td><img src="${stillPath}" alt="Thumbnail"></td><td><input type="text" class="ep-desc" value="${existingEp ? existingEp.overview : episode.overview}"></td><td><input type="url" class="ep-link" value="${existingEp ? existingEp.videoUrl : ''}"></td><td><label class="toggle-switch"><input type="checkbox" class="ep-publish" ${publishChecked}><span class="slider"></span></label></td><td><label class="toggle-switch"><input type="checkbox" class="ep-premium" checked><span class="slider"></span></label></td>`;
                        episodesTableBody.appendChild(row);
                        globalEpisodeCounter++;
                    });
                }
                searchView.style.display = 'none';
                detailsView.style.display = 'block';
                window.scrollTo(0, 0);
            } catch (error) { displayMessage(`Error fetching details: ${error.message}`, 'error'); }
        }
        
        async function loadSeriesForEditing(docId) {
            displayMessage("Loading existing series data...", "info");
            searchView.style.display = 'none';
            detailsView.style.display = 'block';
            submitSeriesBtn.textContent = 'Update Series';
            try {
                const doc = await db.collection('movies').doc(docId).get();
                if (!doc.exists) throw new Error("Series not found.");
                const seriesData = doc.data();
                const episodesSnapshot = await db.collection('movies').doc(docId).collection('episodes').get();
                const episodesData = episodesSnapshot.docs.map(doc => doc.data());
                document.getElementById('vjName').value = seriesData.vjName || '';
                populateCheckboxes('seriesCategories', SERIES_CATEGORIES, seriesData.type);
                populateCheckboxes('sortVjsCheckboxes', VJ_LIST, seriesData.sort_vjs);
                await fetchAndDisplaySeriesDetails(seriesData.tmdbId, episodesData);
            } catch(error) { displayMessage(`Error loading data: ${error.message}`, 'error'); }
        }

        submitSeriesBtn.addEventListener('click', async () => {
            setLoading(submitSeriesBtn, true);
            const vjName = document.getElementById('vjName').value.trim();
            if (!vjName) {
                displayMessage('VJ Name is required.', 'error');
                setLoading(submitSeriesBtn, false);
                return;
            }

            let finalDocId = editModeDocId; 

            try {
                const seriesTitle = currentSeriesData.name;
                const uniqueRefId = `${currentSeriesData.id}_${generateSlug(vjName)}_${generateSlug(seriesTitle)}`;
                const tmdbGenres = currentSeriesData.genres.map(g => g.name);

                const mainDocPayload = {
                    title: seriesTitle,
                    vjName: vjName,
                    tmdbId: currentSeriesData.id,
                    unique_reference_id: uniqueRefId,
                    posterUrl: currentSeriesData.poster_path ? `https://image.tmdb.org/t/p/w500${currentSeriesData.poster_path}` : '',
                    backdropUrl: currentSeriesData.backdrop_path ? `https://image.tmdb.org/t/p/original${currentSeriesData.backdrop_path}` : '',
                    overview: currentSeriesData.overview,
                    genres: tmdbGenres,
                    sort_genres: tmdbGenres,
                    contentType: 'tv',
                    type: Array.from(document.querySelectorAll('#seriesCategories input:checked')).map(cb => cb.value),
                    sort_vjs: Array.from(document.querySelectorAll('#sortVjsCheckboxes input:checked')).map(cb => cb.value),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                };
                
                const duplicateCheck = await checkForDuplicates(mainDocPayload, editModeDocId);
                if (duplicateCheck.found) {
                    throw new Error(duplicateCheck.field);
                }

                const episodesPayload = [];
                episodesTableBody.querySelectorAll('tr').forEach(row => {
                    const videoUrl = row.querySelector('.ep-link').value.trim();
                    if (videoUrl) {
                        episodesPayload.push({
                            season_number: parseInt(row.dataset.seasonNumber),
                            episode_number: parseInt(row.dataset.episodeNumber),
                            title: row.querySelector('.ep-name').textContent,
                            overview: row.querySelector('.ep-desc').value,
                            videoUrl: videoUrl,
                            published: row.querySelector('.ep-publish').checked,
                            isPremium: row.querySelector('.ep-premium').checked,
                        });
                    }
                });
                
                if (editModeDocId) {
                    const docRef = db.collection('movies').doc(editModeDocId);
                    const episodesRef = docRef.collection('episodes');
                    const oldEpisodesSnapshot = await episodesRef.get();
                    const batch = db.batch();
                    batch.update(docRef, mainDocPayload);
                    oldEpisodesSnapshot.forEach(doc => {
                        batch.delete(doc.ref);
                    });
                    episodesPayload.forEach(epData => {
                        const newEpRef = episodesRef.doc();
                        batch.set(newEpRef, { ...epData, addedAt: firebase.firestore.FieldValue.serverTimestamp() });
                    });
                    await batch.commit();
                } else {
                    if (episodesPayload.length === 0) {
                        throw new Error("Cannot create a new series. Please add at least one video link.");
                    }
                    mainDocPayload.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    const docRef = await db.collection('movies').add(mainDocPayload);
                    finalDocId = docRef.id;
                    const batch = db.batch();
                    episodesPayload.forEach(ep => {
                        batch.set(docRef.collection('episodes').doc(), { ...ep, addedAt: firebase.firestore.FieldValue.serverTimestamp() });
                    });
                    await batch.commit();
                }
                
                displayMessage(`Series successfully ${editModeDocId ? 'updated' : 'created'}!`, 'success');

                if (mainDocPayload.type.includes('send_notification')) {
                    const notifTitle = `${mainDocPayload.title} by ${mainDocPayload.vjName} is now available!`;
                    const notifBody = mainDocPayload.overview;
                    const notifImage = mainDocPayload.backdropUrl;
                    const notifUrl = `streamzonemovies://details?id=${finalDocId}`;
                    sendNotification(notifTitle, notifBody, notifImage, notifUrl, formMessage);
                }

                setTimeout(() => { window.location.href = 'index.html'; }, 3500);

            } catch (error) {
                displayMessage(`Operation failed: ${error.message}`, 'error');
            } finally {
                setLoading(submitSeriesBtn, false);
            }
        });
        
        cancelBtn.addEventListener('click', () => {
            if(confirm('Are you sure? Any unsaved changes will be lost.')){
                window.location.href = 'index.html';
            }
        });
    });
</script>

</body>
</html>